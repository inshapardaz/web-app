@echo off
IF "%~1"=="" (SET FOLDER_TO_DELETE=node_modules) ELSE (SET FOLDER_TO_DELETE="%~1")
SET TMPFOLDER=robocopy-tmp-%TIME:~0,2%-%TIME:~3,2%-%TIME:~6,2%
IF EXIST %FOLDER_TO_DELETE% (
	ECHO Removing %FOLDER_TO_DELETE%...
	IF EXIST %TMPFOLDER% RD /s /q %TMPFOLDER%
	MKDIR %TMPFOLDER%
	robocopy %TMPFOLDER%\ %FOLDER_TO_DELETE%\ /e /purge > NUL
	RD %FOLDER_TO_DELETE%
	IF EXIST %FOLDER_TO_DELETE% (
		ECHO Removing %FOLDER_TO_DELETE% failed. Trying again...
		robocopy %TMPFOLDER%\ %FOLDER_TO_DELETE%\ /e /purge > NUL
		RD %FOLDER_TO_DELETE%
		IF EXIST %FOLDER_TO_DELETE% (ECHO Removing %FOLDER_TO_DELETE% failed.) ELSE (ECHO %FOLDER_TO_DELETE% deleted.)
		RD %TMPFOLDER%
	) ELSE (
		ECHO %FOLDER_TO_DELETE% deleted.
		RD %TMPFOLDER%
	)
) ELSE (
	ECHO %FOLDER_TO_DELETE% does not exist.
)
